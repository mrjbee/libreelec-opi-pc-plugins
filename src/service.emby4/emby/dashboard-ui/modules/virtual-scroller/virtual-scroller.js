function getMargins(el){var style=window.getComputedStyle(el);return{marginTop:getMarginValue(style.marginTop),marginRight:getMarginValue(style.marginRight),marginBottom:getMarginValue(style.marginBottom),marginLeft:getMarginValue(style.marginLeft)}}function getMarginValue(value){return value=value?parseFloat(value):NaN,Number.isNaN(value)?0:value}var _getLength=Symbol(),_item=Symbol(),_key=Symbol(),ItemSource=function(){function ItemSource(_ref){var getLength=_ref.getLength,item=_ref.item,key=_ref.key;if(babelHelpers.classCallCheck(this,ItemSource),"function"!=typeof getLength)throw new TypeError("getLength option must be a function");if("function"!=typeof item)throw new TypeError("item option must be a function");if("function"!=typeof key)throw new TypeError("key option must be a function");this[_getLength]=getLength,this[_item]=item,this[_key]=key}return babelHelpers.createClass(ItemSource,[{key:"length",get:function(){return this[_getLength]()}}],[{key:"fromArray",value:function(array,key){if(!Array.isArray(array))throw new TypeError("First argument to fromArray() must be an array");if("function"!=typeof key&&void 0!==key)throw new TypeError("Second argument to fromArray() must be a function or undefined");return new this({getLength:function(){return array.length},item:function(index){return array[index]},key:function(index){return key?key(array[index],index):index}})}}]),ItemSource}(),Layout1dBase=function(_EventTarget){function Layout1dBase(config){var _this;return babelHelpers.classCallCheck(this,Layout1dBase),_this=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(Layout1dBase).call(this)),_this._physicalMin=0,_this._physicalMax=0,_this._first=-1,_this._last=-1,_this._latestCoords={left:0,top:0},_this._itemSize={width:100,height:100},_this._spacing=0,_this._sizeDim="height",_this._secondarySizeDim="width",_this._positionDim="top",_this._secondaryPositionDim="left",_this._direction="vertical",_this._scrollPosition=0,_this._scrollError=0,_this._viewportSize={width:0,height:0},_this._totalItems=0,_this._scrollSize=1,_this._overhang=150,_this._pendingReflow=!1,_this._scrollToIndex=-1,_this._scrollToAnchor=0,Object.assign(babelHelpers.assertThisInitialized(_this),config),_this}return babelHelpers.inherits(Layout1dBase,_EventTarget),babelHelpers.createClass(Layout1dBase,[{key:"reflowIfNeeded",value:function(){this._pendingReflow&&(this._pendingReflow=!1,this._reflow())}},{key:"scrollToIndex",value:function(index){var position=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"start";if(Number.isFinite(index)){switch(index=Math.min(this.totalItems,Math.max(0,index)),this._scrollToIndex=index,"nearest"===position&&(position=index>this._first+this._num/2?"end":"start"),position){case"start":this._scrollToAnchor=0;break;case"center":this._scrollToAnchor=.5;break;case"end":this._scrollToAnchor=1;break;default:throw new TypeError("position must be one of: start, center, end, nearest")}this._scheduleReflow(),this.reflowIfNeeded()}}},{key:"_scheduleReflow",value:function(){this._pendingReflow=!0}},{key:"_reflow",value:function(){var _first=this._first,_last=this._last,_scrollSize=this._scrollSize;this._updateScrollSize(),this._getActiveItems(),this._scrollIfNeeded(),this._scrollSize!==_scrollSize&&this._emitScrollSize(),-1===this._first&&-1===this._last?this._emitRange():(this._first!==_first||this._last!==_last||this._spacingChanged)&&(this._emitRange(),this._emitChildPositions()),this._emitScrollError()}},{key:"_updateScrollSize",value:function(){this._scrollSize=Math.max(1,this._totalItems*this._delta)}},{key:"_checkThresholds",value:function(){if(0===this._viewDim1&&this._num>0)this._scheduleReflow();else{var min=Math.max(0,this._scrollPosition-this._overhang),max=Math.min(this._scrollSize,this._scrollPosition+this._viewDim1+this._overhang);(this._physicalMin>min||this._physicalMax<max)&&this._scheduleReflow()}}},{key:"_scrollIfNeeded",value:function(){if(-1!==this._scrollToIndex){var index=this._scrollToIndex,anchor=this._scrollToAnchor,pos=this._getItemPosition(index)[this._positionDim],size=this._getItemSize(index)[this._sizeDim],curAnchorPos=this._scrollPosition+this._viewDim1*anchor,newAnchorPos=pos+size*anchor,scrollPosition=Math.floor(Math.min(this._scrollSize-this._viewDim1,Math.max(0,this._scrollPosition-curAnchorPos+newAnchorPos)));this._scrollError+=this._scrollPosition-scrollPosition,this._scrollPosition=scrollPosition}}},{key:"_emitRange",value:function(inProps){var detail=Object.assign({first:this._first,last:this._last,num:this._num,stable:!0},inProps);this.dispatchEvent(new CustomEvent("rangechange",{detail:detail}))}},{key:"_emitScrollSize",value:function(){var detail=babelHelpers.defineProperty({},this._sizeDim,this._scrollSize);this.dispatchEvent(new CustomEvent("scrollsizechange",{detail:detail}))}},{key:"_emitScrollError",value:function(){if(this._scrollError){var _detail2,detail=(_detail2={},babelHelpers.defineProperty(_detail2,this._positionDim,this._scrollError),babelHelpers.defineProperty(_detail2,this._secondaryPositionDim,0),_detail2);this.dispatchEvent(new CustomEvent("scrollerrorchange",{detail:detail})),this._scrollError=0}}},{key:"_emitChildPositions",value:function(){for(var detail={},idx=this._first;idx<=this._last;idx++)detail[idx]=this._getItemPosition(idx);this.dispatchEvent(new CustomEvent("itempositionchange",{detail:detail}))}},{key:"_itemDim2Changed",value:function(){}},{key:"_viewDim2Changed",value:function(){}},{key:"_scrollPositionChanged",value:function(oldPos,newPos){var maxPos=this._scrollSize-this._viewDim1;(oldPos<maxPos||newPos<maxPos)&&(this._scrollToIndex=-1)}},{key:"_getActiveItems",value:function(){}},{key:"_getItemPosition",value:function(idx){}},{key:"_getItemSize",value:function(idx){var _ref2;return _ref2={},babelHelpers.defineProperty(_ref2,this._sizeDim,this._itemDim1),babelHelpers.defineProperty(_ref2,this._secondarySizeDim,this._itemDim2),_ref2}},{key:"totalItems",get:function(){return this._totalItems},set:function(num){num!==this._totalItems&&(this._totalItems=num,this._scheduleReflow())}},{key:"direction",get:function(){return this._direction},set:function(dir){(dir="horizontal"===dir?dir:"vertical")!==this._direction&&(this._direction=dir,this._sizeDim="horizontal"===dir?"width":"height",this._secondarySizeDim="horizontal"===dir?"height":"width",this._positionDim="horizontal"===dir?"left":"top",this._secondaryPositionDim="horizontal"===dir?"top":"left",this._scheduleReflow())}},{key:"itemSize",get:function(){return this._itemSize},set:function(dims){var _itemDim1=this._itemDim1,_itemDim2=this._itemDim2;Object.assign(this._itemSize,dims),_itemDim1===this._itemDim1&&_itemDim2===this._itemDim2||(_itemDim2!==this._itemDim2?this._itemDim2Changed():this._scheduleReflow())}},{key:"spacing",get:function(){return this._spacing},set:function(px){px!==this._spacing&&(this._spacing=px,this._scheduleReflow())}},{key:"viewportSize",get:function(){return this._viewportSize},set:function(dims){var _viewDim1=this._viewDim1,_viewDim2=this._viewDim2;Object.assign(this._viewportSize,dims),_viewDim2!==this._viewDim2?this._viewDim2Changed():_viewDim1!==this._viewDim1&&this._checkThresholds()}},{key:"viewportScroll",get:function(){return this._latestCoords},set:function(coords){Object.assign(this._latestCoords,coords);var oldPos=this._scrollPosition;this._scrollPosition=this._latestCoords[this._positionDim],oldPos!==this._scrollPosition&&this._scrollPositionChanged(oldPos,this._scrollPosition),this._checkThresholds()}},{key:"_delta",get:function(){return this._itemDim1+this._spacing}},{key:"_itemDim1",get:function(){return this._itemSize[this._sizeDim]}},{key:"_itemDim2",get:function(){return this._itemSize[this._secondarySizeDim]}},{key:"_viewDim1",get:function(){return this._viewportSize[this._sizeDim]}},{key:"_viewDim2",get:function(){return this._viewportSize[this._secondarySizeDim]}},{key:"_num",get:function(){return-1===this._first||-1===this._last?0:this._last-this._first+1}}]),Layout1dBase}(babelHelpers.wrapNativeSuper(EventTarget)),Layout1dGrid=function(_Layout1dBase){function Layout1dGrid(config){var _this2;return babelHelpers.classCallCheck(this,Layout1dGrid),_this2=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(Layout1dGrid).call(this,config)),_this2._rolumns=1,_this2}return babelHelpers.inherits(Layout1dGrid,_Layout1dBase),babelHelpers.createClass(Layout1dGrid,[{key:"updateItemSizes",value:function(sizes){var size=Object.values(sizes)[0];size&&(this.itemSize=size)}},{key:"_viewDim2Changed",value:function(){this._defineGrid()}},{key:"_itemDim2Changed",value:function(){this._defineGrid()}},{key:"_getActiveItems",value:function(){var min=Math.max(0,this._scrollPosition-this._overhang),max=Math.min(this._scrollSize,this._scrollPosition+this._viewDim1+this._overhang),firstCow=Math.floor(min/this._delta),lastCow=Math.ceil(max/this._delta)-1;this._first=firstCow*this._rolumns,this._last=Math.min((lastCow+1)*this._rolumns-1,this._totalItems),this._physicalMin=this._delta*firstCow,this._physicalMax=this._delta*(lastCow+1)}},{key:"_getItemPosition",value:function(idx){var _ref3;return _ref3={},babelHelpers.defineProperty(_ref3,this._positionDim,Math.floor(idx/this._rolumns)*this._delta),babelHelpers.defineProperty(_ref3,this._secondaryPositionDim,this._spacing+idx%this._rolumns*(this._spacing+this._itemDim2)),_ref3}},{key:"_defineGrid",value:function(){var _spacing=this._spacing;this._rolumns=Math.max(1,Math.floor(this._viewDim2/this._itemDim2)),this._rolumns>1&&(this._spacing=this._viewDim2%(this._rolumns*this._itemDim2)/(this._rolumns+1)),this._spacingChanged=!(_spacing===this._spacing),this._scheduleReflow()}},{key:"_updateScrollSize",value:function(){this._scrollSize=Math.max(1,Math.ceil(this._totalItems/this._rolumns)*this._delta)}}]),Layout1dGrid}(Layout1dBase),Layout1d=function(_Layout1dBase2){function Layout1d(config){var _this3;return babelHelpers.classCallCheck(this,Layout1d),_this3=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(Layout1d).call(this,config)),_this3._physicalItems=new Map,_this3._newPhysicalItems=new Map,_this3._metrics=new Map,_this3._anchorIdx=null,_this3._anchorPos=null,_this3._stable=!0,_this3._needsRemeasure=!1,_this3._nMeasured=0,_this3._tMeasured=0,_this3._estimate=!0,_this3}return babelHelpers.inherits(Layout1d,_Layout1dBase2),babelHelpers.createClass(Layout1d,[{key:"updateItemSizes",value:function(sizes){var _this4=this;Object.keys(sizes).forEach(function(key){var metrics=sizes[key],mi=_this4._getMetrics(key),prevSize=mi[_this4._sizeDim];mi.width=metrics.width+(metrics.marginLeft||0)+(metrics.marginRight||0),mi.height=metrics.height+(metrics.marginTop||0)+(metrics.marginBottom||0);var size=mi[_this4._sizeDim],item=_this4._getPhysicalItem(Number(key));if(item){var delta;void 0!==size&&(item.size=size,void 0===prevSize?(delta=size,_this4._nMeasured++):delta=size-prevSize),_this4._tMeasured=_this4._tMeasured+delta}}),this._nMeasured?(this._updateItemSize(),this._scheduleReflow()):console.warn("No items measured yet.")}},{key:"_updateItemSize",value:function(){this._itemSize[this._sizeDim]=Math.round(this._tMeasured/this._nMeasured)}},{key:"_getMetrics",value:function(idx){return this._metrics[idx]=this._metrics[idx]||{}}},{key:"_getPhysicalItem",value:function(idx){return this._newPhysicalItems.get(idx)||this._physicalItems.get(idx)}},{key:"_getSize",value:function(idx){var item=this._getPhysicalItem(idx);return item&&item.size}},{key:"_getPosition",value:function(idx){var item=this._physicalItems.get(idx);return item?item.pos:idx*this._delta+this._spacing}},{key:"_calculateAnchor",value:function(lower,upper){return 0===lower?0:upper>this._scrollSize-this._viewDim1?this._totalItems-1:Math.max(0,Math.min(this._totalItems-1,Math.floor((lower+upper)/2/this._delta)))}},{key:"_getAnchor",value:function(lower,upper){if(0===this._physicalItems.size)return this._calculateAnchor(lower,upper);if(this._first<0)return console.error("_getAnchor: negative _first"),this._calculateAnchor(lower,upper);if(this._last<0)return console.error("_getAnchor: negative _last"),this._calculateAnchor(lower,upper);var firstItem=this._getPhysicalItem(this._first),lastItem=this._getPhysicalItem(this._last),firstMin=firstItem.pos,firstMax=firstMin+firstItem.size,lastMin=lastItem.pos,lastMax=lastMin+lastItem.size;if(lastMax<lower)return this._calculateAnchor(lower,upper);if(firstMin>upper)return this._calculateAnchor(lower,upper);if(firstMin>=lower||firstMax>=lower)return this._first;if(lastMax<=upper||lastMin<=upper)return this._last;for(var maxIdx=this._last,minIdx=this._first;;){var candidateIdx=Math.round((maxIdx+minIdx)/2),candidate=this._physicalItems.get(candidateIdx),cMin=candidate.pos,cMax=cMin+candidate.size;if(cMin>=lower&&cMin<=upper||cMax>=lower&&cMax<=upper)return candidateIdx;cMax<lower?minIdx=candidateIdx+1:cMin>upper&&(maxIdx=candidateIdx-1)}}},{key:"_getActiveItems",value:function(){if(0===this._viewDim1||0===this._totalItems)this._clearItems();else{var upper=Math.min(this._scrollSize,this._scrollPosition+this._viewDim1+this._overhang),lower=Math.max(0,upper-this._viewDim1-2*this._overhang);this._getItems(lower,upper)}}},{key:"_clearItems",value:function(){this._first=-1,this._last=-1,this._physicalMin=0,this._physicalMax=0;var items=this._newPhysicalItems;this._newPhysicalItems=this._physicalItems,this._newPhysicalItems.clear(),this._physicalItems=items,this._stable=!0}},{key:"_getItems",value:function(lower,upper){var items=this._newPhysicalItems;null!==this._anchorIdx&&null!==this._anchorPos||(this._anchorIdx=this._getAnchor(lower,upper),this._anchorPos=this._getPosition(this._anchorIdx));var anchorSize=this._getSize(this._anchorIdx);void 0===anchorSize&&(anchorSize=this._itemDim1);var anchorErr=0;for(this._anchorPos+anchorSize+this._spacing<lower&&(anchorErr=lower-(this._anchorPos+anchorSize+this._spacing)),this._anchorPos>upper&&(anchorErr=upper-this._anchorPos),anchorErr&&(this._scrollPosition-=anchorErr,lower-=anchorErr,upper-=anchorErr,this._scrollError+=anchorErr),items.set(this._anchorIdx,{pos:this._anchorPos,size:anchorSize}),this._first=this._last=this._anchorIdx,this._physicalMin=this._physicalMax=this._anchorPos,this._stable=!0;this._physicalMin>lower&&this._first>0;){var size=this._getSize(--this._first);void 0===size&&(this._stable=!1,size=this._itemDim1);var pos=this._physicalMin-=size+this._spacing;if(items.set(this._first,{pos:pos,size:size}),!1===this._stable&&!1===this._estimate)break}for(;this._physicalMax<upper&&this._last<this._totalItems;){var _size=this._getSize(this._last);if(void 0===_size&&(this._stable=!1,_size=this._itemDim1),items.set(this._last++,{pos:this._physicalMax,size:_size}),!1===this._stable&&!1===this._estimate)break;this._physicalMax+=_size+this._spacing}this._last--;var extentErr=this._calculateError();extentErr&&(this._physicalMin-=extentErr,this._physicalMax-=extentErr,this._anchorPos-=extentErr,this._scrollPosition-=extentErr,items.forEach(function(item){return item.pos-=extentErr}),this._scrollError+=extentErr),this._stable&&(this._newPhysicalItems=this._physicalItems,this._newPhysicalItems.clear(),this._physicalItems=items)}},{key:"_calculateError",value:function(){return 0===this._first?this._physicalMin:this._physicalMin<=0?this._physicalMin-this._first*this._delta:this._last===this._maxIdx?this._physicalMax-this._scrollSize:this._physicalMax>=this._scrollSize?this._physicalMax-this._scrollSize+(this._totalItems-1-this._last)*this._delta:0}},{key:"_updateScrollSize",value:function(){babelHelpers.get(babelHelpers.getPrototypeOf(Layout1d.prototype),"_updateScrollSize",this).call(this),this._scrollSize=Math.max(this._physicalMax,this._scrollSize)}},{key:"_reflow",value:function(){var _first=this._first,_last=this._last,_scrollSize=this._scrollSize;this._updateScrollSize(),this._getActiveItems(),this._scrollIfNeeded(),this._scrollSize!==_scrollSize&&this._emitScrollSize(),this._emitRange(),-1===this._first&&-1===this._last?this._resetReflowState():this._first!==_first||this._last!==_last||this._needsRemeasure?(this._emitChildPositions(),this._emitScrollError()):(this._emitChildPositions(),this._emitScrollError(),this._resetReflowState())}},{key:"_resetReflowState",value:function(){this._anchorIdx=null,this._anchorPos=null,this._stable=!0}},{key:"_getItemPosition",value:function(idx){var _ref4;return _ref4={},babelHelpers.defineProperty(_ref4,this._positionDim,this._getPosition(idx)),babelHelpers.defineProperty(_ref4,this._secondaryPositionDim,0),_ref4}},{key:"_getItemSize",value:function(idx){var _ref5;return _ref5={},babelHelpers.defineProperty(_ref5,this._sizeDim,this._getSize(idx)||this._itemDim1),babelHelpers.defineProperty(_ref5,this._secondarySizeDim,this._itemDim2),_ref5}},{key:"_viewDim2Changed",value:function(){this._needsRemeasure=!0,this._scheduleReflow()}},{key:"_emitRange",value:function(){var remeasure=this._needsRemeasure,stable=this._stable;this._needsRemeasure=!1,babelHelpers.get(babelHelpers.getPrototypeOf(Layout1d.prototype),"_emitRange",this).call(this,{remeasure:remeasure,stable:stable})}}]),Layout1d}(Layout1dBase),VirtualRepeater=function(){function VirtualRepeater(config){babelHelpers.classCallCheck(this,VirtualRepeater),this._createElementFn=null,this._updateElementFn=null,this._recycleElementFn=null,this._elementKeyFn=null,this._measureCallback=null,this._totalItems=0,this._num=1/0,this._first=0,this._last=0,this._prevFirst=0,this._prevLast=0,this._needsReset=!1,this._needsRemeasure=!1,this._pendingRender=null,this._container=null,this._ordered=[],this._active=new Map,this._prevActive=new Map,this._keyToChild=new Map,this._childToKey=new WeakMap,this._indexToMeasure={},this.__incremental=!1,config&&Object.assign(this,config)}return babelHelpers.createClass(VirtualRepeater,[{key:"requestReset",value:function(){this._needsReset=!0,this._scheduleRender()}},{key:"requestRemeasure",value:function(){this._needsRemeasure=!0,this._scheduleRender()}},{key:"_shouldRender",value:function(){return Boolean(this.container&&this.createElement)}},{key:"_scheduleRender",value:function(){var _this5=this;this._pendingRender||(this._pendingRender=requestAnimationFrame(function(){_this5._pendingRender=null,_this5._shouldRender()&&_this5._render()}))}},{key:"_measureChildren",value:function(_ref6){var _this6=this,indices=_ref6.indices,children=_ref6.children,pm=children.map(function(c,i){return _this6._indexToMeasure[indices[i]]||_this6._measureChild(c)}),mm=pm.reduce(function(out,cur,i){return out[indices[i]]=_this6._indexToMeasure[indices[i]]=cur,out},{});this._measureCallback(mm)}},{key:"_render",value:function(){var _this7=this,rangeChanged=this._first!==this._prevFirst||this._num!==this._prevNum;(rangeChanged||this._needsReset)&&(this._last=this._first+Math.min(this._num,this._totalItems-this._first)-1,(this._num||this._prevNum)&&(this._needsReset?this._reset(this._first,this._last):(this._discardHead(),this._discardTail(),this._addHead(),this._addTail()))),(this._needsRemeasure||this._needsReset)&&(this._indexToMeasure={});var shouldMeasure=this._num>0&&this._measureCallback&&(rangeChanged||this._needsRemeasure||this._needsReset),toMeasure=shouldMeasure?this._toMeasure:null;this._incremental||(this._prevActive.forEach(function(idx,child){return _this7._unassignChild(child,idx)}),this._prevActive.clear()),this._prevFirst=this._first,this._prevLast=this._last,this._prevNum=this._num,this._needsReset=!1,this._needsRemeasure=!1,this._didRender(),toMeasure&&this._measureChildren(toMeasure)}},{key:"_didRender",value:function(){}},{key:"_discardHead",value:function(){for(var o=this._ordered,idx=this._prevFirst;o.length&&idx<this._first;idx++)this._unassignChild(o.shift(),idx)}},{key:"_discardTail",value:function(){for(var o=this._ordered,idx=this._prevLast;o.length&&idx>this._last;idx--)this._unassignChild(o.pop(),idx)}},{key:"_addHead",value:function(){for(var start=this._first,end=Math.min(this._last,this._prevFirst-1),idx=end;idx>=start;idx--){var child=this._assignChild(idx);this._insertBefore(child,this._firstChild),this.updateElement&&this.updateElement(child,idx),this._ordered.unshift(child)}}},{key:"_addTail",value:function(){for(var start=Math.max(this._first,this._prevLast+1),end=this._last,idx=start;idx<=end;idx++){var child=this._assignChild(idx);this._insertBefore(child,null),this.updateElement&&this.updateElement(child,idx),this._ordered.push(child)}}},{key:"_reset",value:function(first,last){var prevActive=this._active;this._active=this._prevActive,this._prevActive=prevActive,this._ordered.length=0;for(var currentMarker=this._firstChild,i=first;i<=last;i++){var child=this._assignChild(i);this._ordered.push(child),currentMarker?currentMarker===this._node(child)?currentMarker=this._nextSibling(child):this._insertBefore(child,currentMarker):this._childIsAttached(child)||this._insertBefore(child,null),this.updateElement&&this.updateElement(child,i)}}},{key:"_assignChild",value:function(idx){var child,key=this.elementKey?this.elementKey(idx):idx;return(child=this._keyToChild.get(key))?this._prevActive.delete(child):(child=this.createElement(idx),this._keyToChild.set(key,child),this._childToKey.set(child,key)),this._showChild(child),this._active.set(child,idx),child}},{key:"_unassignChild",value:function(child,idx){if(this._hideChild(child),this._incremental)this._active.delete(child),this._prevActive.set(child,idx);else{var key=this._childToKey.get(child);this._childToKey.delete(child),this._keyToChild.delete(key),this._active.delete(child),this.recycleElement?this.recycleElement(child,idx):this._node(child).parentNode&&this._removeChild(child)}}},{key:"_node",value:function(child){return child}},{key:"_nextSibling",value:function(child){return child.nextSibling}},{key:"_insertBefore",value:function(child,referenceNode){this._container.insertBefore(child,referenceNode)}},{key:"_removeChild",value:function(child){child.parentNode.removeChild(child)}},{key:"_childIsAttached",value:function(child){var node=this._node(child);return node&&node.parentNode===this._container}},{key:"_hideChild",value:function(child){child.style&&(child.style.display="none")}},{key:"_showChild",value:function(child){child.style&&(child.style.display=null)}},{key:"_measureChild",value:function(child){var _child$getBoundingCli=child.getBoundingClientRect(),width=_child$getBoundingCli.width,height=_child$getBoundingCli.height;return Object.assign({width:width,height:height},getMargins(child))}},{key:"container",get:function(){return this._container},set:function(container){var _this8=this;container!==this._container&&(this._container&&this._ordered.forEach(function(child){return _this8._removeChild(child)}),this._container=container,container?this._ordered.forEach(function(child){return _this8._insertBefore(child,null)}):(this._ordered.length=0,this._active.clear(),this._prevActive.clear()),this.requestReset())}},{key:"createElement",get:function(){return this._createElementFn},set:function(fn){fn!==this._createElementFn&&(this._createElementFn=fn,this._keyToChild.clear(),this.requestReset())}},{key:"updateElement",get:function(){return this._updateElementFn},set:function(fn){fn!==this._updateElementFn&&(this._updateElementFn=fn,this.requestReset())}},{key:"recycleElement",get:function(){return this._recycleElementFn},set:function(fn){fn!==this._recycleElementFn&&(this._recycleElementFn=fn,this.requestReset())}},{key:"elementKey",get:function(){return this._elementKeyFn},set:function(fn){fn!==this._elementKeyFn&&(this._elementKeyFn=fn,this._keyToChild.clear(),this.requestReset())}},{key:"first",get:function(){return this._first},set:function(idx){if("number"!=typeof idx)throw new Error("New value must be a number.");var newFirst=Math.max(0,Math.min(idx,this._totalItems-this._num));newFirst!==this._first&&(this._first=newFirst,this._scheduleRender())}},{key:"num",get:function(){return this._num},set:function(n){if("number"!=typeof n)throw new Error("New value must be a number.");n!==this._num&&(this._num=n,this.first=this._first,this._scheduleRender())}},{key:"totalItems",get:function(){return this._totalItems},set:function(num){if("number"!=typeof num)throw new Error("New value must be a number.");num!==this._totalItems&&(this._totalItems=num,this.first=this._first,this.requestReset())}},{key:"_incremental",get:function(){return this.__incremental},set:function(inc){inc!==this.__incremental&&(this.__incremental=inc,this._scheduleRender())}},{key:"_toMeasure",get:function(){var _this9=this;return this._ordered.reduce(function(toMeasure,c,i){var idx=_this9._first+i;return(_this9._needsReset||_this9._needsRemeasure||idx<_this9._prevFirst||idx>_this9._prevLast)&&(toMeasure.indices.push(idx),toMeasure.children.push(c)),toMeasure},{indices:[],children:[]})}},{key:"_firstChild",get:function(){return this._ordered.length&&this._childIsAttached(this._ordered[0])?this._node(this._ordered[0]):null}}]),VirtualRepeater}(),RangeChangeEvent=function(_Event){function RangeChangeEvent(type,init){var _this10;return babelHelpers.classCallCheck(this,RangeChangeEvent),_this10=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(RangeChangeEvent).call(this,type,init)),_this10._first=Math.floor(init.first||0),_this10._last=Math.floor(init.last||0),_this10}return babelHelpers.inherits(RangeChangeEvent,_Event),babelHelpers.createClass(RangeChangeEvent,[{key:"first",get:function(){return this._first}},{key:"last",get:function(){return this._last}}]),RangeChangeEvent}(babelHelpers.wrapNativeSuper(Event)),VirtualScroller=function(_VirtualRepeater){function VirtualScroller(config){var _this11;return babelHelpers.classCallCheck(this,VirtualScroller),_this11=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(VirtualScroller).call(this)),_this11._num=0,_this11._first=-1,_this11._last=-1,_this11._prevFirst=-1,_this11._prevLast=-1,_this11._needsUpdateView=!1,_this11._layout=null,_this11._scrollTarget=null,_this11._sizer=null,_this11._scrollSize=null,_this11._scrollErr=null,_this11._childrenPos=null,_this11._containerElement=null,_this11._containerInlineStyle=null,_this11._containerSize=null,_this11._containerRO=new ResizeObserver(function(entries){return _this11._containerSizeChanged(entries[0].contentRect)}),_this11._skipNextChildrenSizeChanged=!1,_this11._childrenRO=new ResizeObserver(function(entries){return _this11._childrenSizeChanged(entries)}),config&&Object.assign(babelHelpers.assertThisInitialized(_this11),config),_this11}return babelHelpers.inherits(VirtualScroller,_VirtualRepeater),babelHelpers.createClass(VirtualScroller,[{key:"_render",value:function(){var _this12=this;for(this._childrenRO.disconnect(),this._layout.totalItems=this.totalItems,this._needsUpdateView&&(this._needsUpdateView=!1,this._updateView()),this._layout.reflowIfNeeded();;)if(this._pendingRender&&(cancelAnimationFrame(this._pendingRender),this._pendingRender=null),this._sizeContainer(this._scrollSize),this._scrollErr&&(this._correctScrollError(this._scrollErr),this._scrollErr=null),babelHelpers.get(babelHelpers.getPrototypeOf(VirtualScroller.prototype),"_render",this).call(this),this._layout.reflowIfNeeded(),!this._pendingRender)break;this._skipNextChildrenSizeChanged=!0,this._kids.forEach(function(child){return _this12._childrenRO.observe(child)})}},{key:"_didRender",value:function(){this._childrenPos&&(this._positionChildren(this._childrenPos),this._childrenPos=null)}},{key:"handleEvent",value:function(event){switch(event.type){case"scroll":this._scrollTarget&&event.target!==this._scrollTarget||this._scheduleUpdateView();break;case"scrollsizechange":this._scrollSize=event.detail,this._scheduleRender();break;case"scrollerrorchange":this._scrollErr=event.detail,this._scheduleRender();break;case"itempositionchange":this._childrenPos=event.detail,this._scheduleRender();break;case"rangechange":this._adjustRange(event.detail);break;default:console.warn("event not handled",event)}}},{key:"_createContainerSizer",value:function(){var sizer=document.createElement("div");return Object.assign(sizer.style,{position:"absolute",margin:"-2px 0 0 0",padding:0,visibility:"hidden",fontSize:"2px"}),sizer.innerHTML="&nbsp;",sizer}},{key:"_scheduleUpdateView",value:function(){this._needsUpdateView=!0,this._scheduleRender()}},{key:"_updateView",value:function(){var width,height,top,left;if(this._scrollTarget===this._containerElement)width=this._containerSize.width,height=this._containerSize.height,left=this._containerElement.scrollLeft,top=this._containerElement.scrollTop;else{var containerBounds=this._containerElement.getBoundingClientRect(),scrollBounds=this._scrollTarget?this._scrollTarget.getBoundingClientRect():{top:0,left:0,width:innerWidth,height:innerHeight},scrollerWidth=scrollBounds.width,scrollerHeight=scrollBounds.height,xMin=Math.max(0,Math.min(scrollerWidth,containerBounds.left-scrollBounds.left)),yMin=Math.max(0,Math.min(scrollerHeight,containerBounds.top-scrollBounds.top)),xMax="vertical"===this._layout.direction?Math.max(0,Math.min(scrollerWidth,containerBounds.right-scrollBounds.left)):scrollerWidth,yMax="vertical"===this._layout.direction?scrollerHeight:Math.max(0,Math.min(scrollerHeight,containerBounds.bottom-scrollBounds.top));width=xMax-xMin,height=yMax-yMin,left=Math.max(0,-(containerBounds.x-scrollBounds.left)),top=Math.max(0,-(containerBounds.y-scrollBounds.top))}this._layout.viewportSize={width:width,height:height},this._layout.viewportScroll={top:top,left:left}}},{key:"_sizeContainer",value:function(size){if(this._scrollTarget===this._containerElement){var left=size&&size.width?size.width-1:0,top=size&&size.height?size.height-1:0;this._sizer.style.transform="translate(".concat(left,"px, ").concat(top,"px)")}else{var style=this._containerElement.style;style.minWidth=size&&size.width?size.width+"px":null,style.minHeight=size&&size.height?size.height+"px":null}}},{key:"_positionChildren",value:function(pos){var _this13=this,kids=this._kids;Object.keys(pos).forEach(function(key){var idx=key-_this13._first,child=kids[idx];if(child){var _pos$key=pos[key],top=_pos$key.top,left=_pos$key.left;child.style.position="absolute",child.style.transform="translate(".concat(left,"px, ").concat(top,"px)")}})}},{key:"_adjustRange",value:function(range){this.num=range.num,this.first=range.first,this._incremental=!range.stable,range.remeasure?this.requestRemeasure():range.stable&&this._notifyStable()}},{key:"_shouldRender",value:function(){if(!babelHelpers.get(babelHelpers.getPrototypeOf(VirtualScroller.prototype),"_shouldRender",this).call(this)||!this._layout)return!1;if(null===this._containerSize){var _this$_containerEleme=this._containerElement.getBoundingClientRect(),width=_this$_containerEleme.width,height=_this$_containerEleme.height;this._containerSize={width:width,height:height}}return this._containerSize.width>0||this._containerSize.height>0}},{key:"_correctScrollError",value:function(err){this._scrollTarget?(this._scrollTarget.scrollTop-=err.top,this._scrollTarget.scrollLeft-=err.left):window.scroll(window.scrollX-err.left,window.scrollY-err.top)}},{key:"_notifyStable",value:function(){var first=this.first,num=this.num,last=first+num-1;this._container.dispatchEvent(new RangeChangeEvent("rangechange",{first:first,last:last}))}},{key:"_containerSizeChanged",value:function(size){var width=size.width,height=size.height;this._containerSize={width:width,height:height},this._scheduleUpdateView()}},{key:"_childrenSizeChanged",value:function(){this._skipNextChildrenSizeChanged?this._skipNextChildrenSizeChanged=!1:this.requestRemeasure()}},{key:"container",get:function(){return babelHelpers.get(babelHelpers.getPrototypeOf(VirtualScroller.prototype),"container",this)},set:function(container){babelHelpers.set(babelHelpers.getPrototypeOf(VirtualScroller.prototype),"container",container,this,!0);var oldEl=this._containerElement,newEl=container&&container.nodeType===Node.DOCUMENT_FRAGMENT_NODE?container.host:container
;oldEl!==newEl&&(this._containerRO.disconnect(),this._containerSize=null,oldEl?(this._containerInlineStyle?oldEl.setAttribute("style",this._containerInlineStyle):oldEl.removeAttribute("style"),this._containerInlineStyle=null,oldEl===this._scrollTarget&&(oldEl.removeEventListener("scroll",this,{passive:!0}),this._sizer&&this._sizer.remove())):addEventListener("scroll",this,{passive:!0}),this._containerElement=newEl,newEl&&(this._containerInlineStyle=newEl.getAttribute("style")||null,newEl===this._scrollTarget&&(this._sizer=this._sizer||this._createContainerSizer(),this._container.prepend(this._sizer)),this._scheduleUpdateView(),this._containerRO.observe(newEl)))}},{key:"layout",get:function(){return this._layout},set:function(layout){layout!==this._layout&&(this._layout&&(this._measureCallback=null,this._layout.removeEventListener("scrollsizechange",this),this._layout.removeEventListener("scrollerrorchange",this),this._layout.removeEventListener("itempositionchange",this),this._layout.removeEventListener("rangechange",this),this._containerElement&&this._sizeContainer()),this._layout=layout,this._layout&&("function"==typeof this._layout.updateItemSizes&&(this._measureCallback=this._layout.updateItemSizes.bind(this._layout),this.requestRemeasure()),this._layout.addEventListener("scrollsizechange",this),this._layout.addEventListener("scrollerrorchange",this),this._layout.addEventListener("itempositionchange",this),this._layout.addEventListener("rangechange",this),this._scheduleUpdateView()))}},{key:"scrollTarget",get:function(){return this._scrollTarget},set:function(target){target===window&&(target=null),this._scrollTarget!==target&&(this._scrollTarget&&(this._scrollTarget.removeEventListener("scroll",this,{passive:!0}),this._sizer&&this._scrollTarget===this._containerElement&&this._sizer.remove()),this._scrollTarget=target,target&&(target.addEventListener("scroll",this,{passive:!0}),target===this._containerElement&&(this._sizer=this._sizer||this._createContainerSizer(),this._container.prepend(this._sizer))))}},{key:"_kids",get:function(){return this._ordered}}]),VirtualScroller}(VirtualRepeater),_scroller=Symbol(),_createElement=Symbol(),_updateElement=Symbol(),_recycleElement=Symbol(),_nodePool=Symbol(),_itemSource=Symbol(),_elementSource=Symbol(),_firstConnected=Symbol(),_render=Symbol(),VirtualScrollerElement=function(_HTMLElement){function VirtualScrollerElement(){var _this14;babelHelpers.classCallCheck(this,VirtualScrollerElement),_this14=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(VirtualScrollerElement).call(this)),_this14[_scroller]=null,_this14[_nodePool]=[];var childTemplate=null;return _this14[_createElement]=function(){if(_this14[_nodePool]&&_this14[_nodePool].length)return _this14[_nodePool].pop();if(!childTemplate){var template=_this14.querySelector("template");childTemplate=template&&template.content.firstElementChild?template.content.firstElementChild:document.createElement("div")}return childTemplate.cloneNode(!0)},_this14[_updateElement]=function(element,item){return element.textContent=item.toString()},_this14[_recycleElement]=function(element){return _this14[_nodePool].push(element)},_this14[_itemSource]=null,_this14[_elementSource]={},_this14[_firstConnected]=!1,_this14}return babelHelpers.inherits(VirtualScrollerElement,_HTMLElement),babelHelpers.createClass(VirtualScrollerElement,[{key:"connectedCallback",value:function(){this[_firstConnected]||(this.layout||(this.layout="vertical"),this.classList.add("virtual-scroller"),this[_firstConnected]=!0),this[_render]()}},{key:"attributeChangedCallback",value:function(){this[_render]()}},{key:"itemsChanged",value:function(){this[_scroller]&&(this[_render](),this[_scroller].requestReset())}},{key:"scrollToIndex",value:function(index){var _ref7=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_ref7$position=_ref7.position,position=void 0===_ref7$position?"start":_ref7$position;this[_scroller]&&this[_scroller].layout.scrollToIndex(index,position)}},{key:_render,value:function(){var _this15=this;if(this[_firstConnected]&&this.createElement){this[_scroller]||(this[_scroller]=new VirtualScroller({container:this,scrollTarget:this}));var scroller=this[_scroller],layoutAttr=this.layout,Layout=layoutAttr.endsWith("-grid")?Layout1dGrid:Layout1d,direction=layoutAttr.startsWith("horizontal")?"horizontal":"vertical",layout=scroller.layout instanceof Layout&&scroller.layout.direction===direction?scroller.layout:new Layout({direction:direction}),_this$_elementSource=this[_elementSource],createElement=_this$_elementSource.createElement,updateElement=_this$_elementSource.updateElement,recycleElement=_this$_elementSource.recycleElement;createElement||(createElement=this[_elementSource].createElement=function(index){return _this15.createElement(_this15.itemSource[_item](index),index)}),this.updateElement&&!updateElement&&(updateElement=this[_elementSource].updateElement=function(element,index){return _this15.updateElement(element,_this15.itemSource[_item](index),index)}),this.recycleElement&&!recycleElement&&(recycleElement=this[_elementSource].recycleElement=function(element,index){return _this15.recycleElement(element,_this15.itemSource[_item](index),index)});var elementKey=this.itemSource?this.itemSource[_key]:null,totalItems=this.itemSource?this.itemSource.length:0;Object.assign(scroller,{layout:layout,createElement:createElement,updateElement:updateElement,recycleElement:recycleElement,elementKey:elementKey,totalItems:totalItems})}}},{key:"layout",get:function(){return this.getAttribute("layout")},set:function(layout){this.setAttribute("layout",layout)}},{key:"itemSource",get:function(){return this[_itemSource]},set:function(itemSource){this[_itemSource]=Array.isArray(itemSource)?ItemSource.fromArray(itemSource):itemSource,this[_render]()}},{key:"createElement",get:function(){return this[_createElement]},set:function(fn){this[_nodePool]&&(this.recycleElement=null),this[_createElement]=fn,this[_elementSource].createElement=null,this[_render]()}},{key:"updateElement",get:function(){return this[_updateElement]},set:function(fn){this[_updateElement]=fn,this[_elementSource].updateElement=null,this[_render]()}},{key:"recycleElement",get:function(){return this[_recycleElement]},set:function(fn){this[_nodePool]=null,this[_recycleElement]=fn,this[_elementSource].recycleElement=null,this[_render]()}}],[{key:"observedAttributes",get:function(){return["layout"]}}]),VirtualScrollerElement}(babelHelpers.wrapNativeSuper(HTMLElement));customElements.define("virtual-scroller",VirtualScrollerElement);