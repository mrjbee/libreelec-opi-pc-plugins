define(["cardBuilder","loading","connectionManager","apphost","layoutManager","scrollHelper","focusManager","emby-itemscontainer","emby-scroller"],function(cardBuilder,loading,connectionManager,appHost,layoutManager,scrollHelper,focusManager){"use strict";function enableScrollX(section){return"nextup"!==section}function fetchResumeItems(){var apiClient=this.apiClient,parentId=this.params.parentId,limit=enableScrollX("resume")?18:5;return apiClient.getResumableItems(apiClient.getCurrentUserId(),{IncludeItemTypes:"Episode",Limit:limit,Fields:"PrimaryImageAspectRatio,BasicSyncInfo",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb",EnableTotalRecordCount:!1})}function fetchLatestItems(){var parentId=this.params.parentId,query={IncludeItemTypes:"Episode",Limit:30,Fields:"PrimaryImageAspectRatio,BasicSyncInfo",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb,Logo,Banner",GroupItems:!1};return this.apiClient.getLatestItems(query)}function fetchNextUpItems(){var apiClient=this.apiClient,parentId=this.params.parentId;return apiClient.getNextUpEpisodes({ParentId:parentId,Limit:48,Fields:"PrimaryImageAspectRatio,BasicSyncInfo",UserId:apiClient.getCurrentUserId(),ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb",EnableTotalRecordCount:!1})}function getResumeItemsHtml(items){return cardBuilder.getCardsHtml({items:items,preferThumb:!0,shape:getThumbShape("latest"),scalable:!0,showTitle:!0,showParentTitle:!0,overlayText:!1,centerText:!0,overlayPlayButton:!0,cardLayout:!1})}function getLatestItemsHtml(items){return cardBuilder.getCardsHtml({items:items,preferThumb:!0,shape:getThumbShape("resume"),scalable:!0,showTitle:!0,showParentTitle:!0,overlayText:!1,centerText:!0,overlayPlayButton:!0,cardLayout:!1})}function getNextUpItemsHtml(items){return cardBuilder.getCardsHtml({items:items,preferThumb:!0,shape:getThumbShape("nextup"),scalable:!0,showTitle:!0,showParentTitle:!0,overlayText:!1,centerText:!0,overlayPlayButton:!0,cardLayout:!1})}function TvSuggestionsTab(view,params){this.view=view,this.params=params,this.apiClient=connectionManager.getApiClient(params.serverId),initLayout(view),this.resumeItemsContainer=view.querySelector(".resumeSection .itemsContainer"),this.resumeItemsContainer.fetchData=fetchResumeItems.bind(this),this.resumeItemsContainer.getItemsHtml=getResumeItemsHtml.bind(this),this.resumeItemsContainer.parentContainer=view.querySelector(".resumeSection"),this.nextUpItemsContainer=view.querySelector(".nextUpSection .itemsContainer"),this.nextUpItemsContainer.fetchData=fetchNextUpItems.bind(this),this.nextUpItemsContainer.getItemsHtml=getNextUpItemsHtml.bind(this),this.nextUpItemsContainer.parentContainer=view.querySelector(".nextUpSection"),this.latestItemsContainer=view.querySelector(".latestSection .itemsContainer"),this.latestItemsContainer.fetchData=fetchLatestItems.bind(this),this.latestItemsContainer.getItemsHtml=getLatestItemsHtml.bind(this),this.latestItemsContainer.parentContainer=view.querySelector(".latestSection"),params.parentId&&(this.resumeItemsContainer.setAttribute("data-parentid",params.parentId),this.nextUpItemsContainer.setAttribute("data-parentid",params.parentId),this.latestItemsContainer.setAttribute("data-parentid",params.parentId)),layoutManager.tv||initCategorySyncButtons(view,params,this.apiClient)}function initCategorySyncButtons(view,params,apiClient){require(["categorySyncButton"],function(categorySyncButton){apiClient.getCurrentUser().then(function(user){categorySyncButton.init(view.querySelector(".btnSyncLatest"),user,params.serverId,params.parentId),categorySyncButton.init(view.querySelector(".btnSyncNextUp"),user,params.serverId,params.parentId)})})}function initLayout(view){for(var containers=view.querySelectorAll(".autoScrollSection"),i=0,length=containers.length;i<length;i++){var html,section=containers[i];html=enableScrollX(section.getAttribute("data-section"))?'<div is="emby-scroller" class="padded-top-focusscale padded-bottom-focusscale" data-mousewheel="false" data-centerfocus="true"><div is="emby-itemscontainer" class="itemsContainer scrollSlider focuscontainer-x padded-left padded-right" data-monitor="videoplayback,markplayed"></div></div>':'<div is="emby-itemscontainer" class="itemsContainer padded-left padded-right vertical-wrap focuscontainer-x" data-monitor="videoplayback,markplayed"></div>',section.insertAdjacentHTML("beforeend",html)}}function getThumbShape(section){return enableScrollX(section)?"overflowBackdrop":"backdrop"}return TvSuggestionsTab.prototype.onResume=function(options){var promises=(this.apiClient,[]);promises.push(this.resumeItemsContainer.resume(options)),promises.push(this.nextUpItemsContainer.resume(options)),promises.push(this.latestItemsContainer.resume(options));var view=this.view;Promise.all(promises).then(function(){options.autoFocus&&focusManager.autoFocus(view)})},TvSuggestionsTab.prototype.onPause=function(){this.resumeItemsContainer.pause(),this.nextUpItemsContainer.pause(),this.latestItemsContainer.pause()},TvSuggestionsTab.prototype.destroy=function(){this.view=null,this.params=null,this.apiClient=null,this.resumeItemsContainer=null,this.nextUpItemsContainer=null,this.latestItemsContainer=null},TvSuggestionsTab});